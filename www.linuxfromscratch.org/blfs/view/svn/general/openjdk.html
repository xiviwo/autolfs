<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content=
    "application/xhtml+xml; charset=iso-8859-1" />
    <title>
      OpenJDK-1.7.0.40/IcedTea-2.4.1
    </title>
    <link rel="stylesheet" href="../stylesheets/lfs.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.73.2" />
    <link rel="stylesheet" href="../stylesheets/lfs-print.css" type=
    "text/css" media="print" />
  </head>
  <body class="blfs" id="blfs-2013-09-12">
    <div class="navheader">
      <h4>
        Beyond Linux<sup>®</sup> From Scratch - Version 2013-09-12
      </h4>
      <h3>
        Chapter&nbsp;13.&nbsp;Programming
      </h3>
      <ul>
        <li class="prev">
          <a accesskey="p" href="apache-ant.html" title=
          "apache-ant-1.9.2">Prev</a>
          <p>
            apache-ant-1.9.2
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="../basicnet/basicnet.html" title=
          "Networking">Next</a>
          <p>
            Networking
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="prog.html" title=
          "Chapter&nbsp;13.&nbsp;Programming">Up</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Beyond Linux® From Scratch - Version 2013-09-12">Home</a>
        </li>
      </ul>
    </div>
    <div class="sect1" lang="en" xml:lang="en">
      <h1 class="sect1">
        <a id="openjdk" name="openjdk"></a>OpenJDK-1.7.0.40/IcedTea-2.4.1
      </h1>
      <div class="package" lang="en" xml:lang="en">
        <h2 class="sect2">
          Introduction to OpenJDK and IcedTea
        </h2>
        <p>
          <span class="application">IcedTea</span> provides a build harness
          for the <span class="application">OpenJDK</span> package, Oracle's
          open-sourced <span class="application">Java</span> development
          environment. In order to provide a completely free runtime
          environment, similar to Oracle's closed distribution, the
          <span class="application">IcedTea</span> build harness also
          provides free, and arguably better versions of parts of the JDK
          which have not been open-sourced to date. <span class=
          "application">OpenJDK</span> is useful for developing <span class=
          "application">Java</span> programs and provides a complete runtime
          environment to run <span class="application">Java</span> programs.
        </p>
        <p>
          This package is known to build and work properly using an LFS-7.4
          platform.
        </p>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            The browser plugin and webstart implementation have been split
            off into a separate project. To provide a complete
            implementation, you will need to later install <a class="xref"
            href="../xsoft/icedtea-web.html" title=
            "IcedTea-Web-1.4">IcedTea-Web-1.4</a>.
          </p>
        </div>
        <p>
          OpenJDK is GPL'd code, however, it should be explained that there
          has been a special exception made for non-free projects to use
          these classes in their proprietary products. In similar fashion to
          the LGPL, which allows non-free programs to link to libraries
          provided by free software, the <a class="ulink" href=
          "http://openjdk.java.net/legal/gplv2+ce.html">GNU General Public
          License, version 2, with the Classpath Exception</a> allows third
          party programs to use classes provided by free software without the
          requirement that the third party software also be free. As with the
          LGPL, any modifications made to the free software portions of a
          third party application, must also be made freely available.
        </p>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            The IcedTea build environment includes a very thorough, open
            source test suite titled <span class="application">JTreg</span>.
            <span class="application">JTreg</span> is intended to test the
            just built JDK for reasonable compatibility with the closed
            Oracle JDK. However, in order for an independent implementation
            to claim compatibility, including the Oracle sponsored
            <span class="application">OpenJDK</span> project, it must pass a
            closed <span class="application">JCK/TCK</span> test suite. No
            claims of compatibility, even partial compatibility, may be made
            without passing an approved test suite.
          </p>
          <p>
            Oracle does provide free community access, on a case by case
            basis, to a closed toolkit to ensure 100% compatibility with its
            proprietary JDK. The binary version provided here has not been
            tested against the <a class="ulink" href=
            "http://openjdk.java.net/groups/conformance/JckAccess/jck-access.html">
            TCK</a>. Any version that is built using the instructions given,
            cannot claim to be compatible with the proprietary JDK, without
            the user applying for, and completing the compatibility tests
            themselves.
          </p>
          <p>
            With that in mind, the binaries produced using this build method
            are regularly tested against the TCK by the members listed on the
            site above. In addition to the community license above, an
            educational, non-commercial license for the TCK can be obtained
            from <a class="ulink" href=
            "http://www.oracle.com/technetwork/java/index-137188.html">here</a>.
          </p>
        </div>
        <h3>
          Source Package Information
        </h3>
        <div class="itemizedlist">
          <ul class="compact">
            <li>
              <p>
                IcedTea Source Package<br />
                Download: <a class="ulink" href=
                "http://icedtea.classpath.org/download/source/icedtea-2.4.1.tar.gz">
                http://icedtea.classpath.org/download/source/icedtea-2.4.1.tar.gz</a><br />

                Download MD5 sum: cbdefd7d385c61a457924bfbee87e643<br />
                Download Size: 4.6 MB<br />
              </p>
            </li>
          </ul>
        </div>
        <p>
          The following may be downladed separately or be done as a part of
          the <strong class="userinput"><code>make</code></strong> process.
          For convenience the BLFS editors have made the files available in
          an LFS website. The files are not distributed with versions, but
          extracted from the OpenJDK version control system at specified
          (tagged) points.
        </p>
        <div class="itemizedlist">
          <ul class="compact">
            <li>
              <p>
                Corba Source<br />
                Download: <a class="ulink" href=
                "http://anduin.linuxfromscratch.org/files/BLFS/OpenJDK-1.7.0.40/corba.tar.gz">
                http://anduin.linuxfromscratch.org/files/BLFS/OpenJDK-1.7.0.40/corba.tar.gz</a><br />

                Download MD5 sum: b4a1f9a5553f92d285bff3f8076e61dd<br />
                Download Size: 1.4 MB<br />
              </p>
            </li>
            <li>
              <p>
                Hotspot Source<br />
                Download: <a class="ulink" href=
                "http://anduin.linuxfromscratch.org/files/BLFS/OpenJDK-1.7.0.40/hotspot.tar.gz">
                http://anduin.linuxfromscratch.org/files/BLFS/OpenJDK-1.7.0.40/hotspot.tar.gz</a><br />

                Download MD5 sum: 42bfcd67d4649b3eb30649a010b9ac0a<br />
                Download Size: 9.2 MB<br />
              </p>
            </li>
            <li>
              <p>
                IcedTea Build Source<br />
                Download: <a class="ulink" href=
                "http://anduin.linuxfromscratch.org/files/BLFS/OpenJDK-1.7.0.40/openjdk.tar.gz">
                http://anduin.linuxfromscratch.org/files/BLFS/OpenJDK-1.7.0.40/openjdk.tar.gz</a><br />

                Download MD5 sum: 165e07ce440848e437f74851f09cce81<br />
                Download Size: 136 KB<br />
              </p>
            </li>
            <li>
              <p>
                JAXP Source<br />
                Download: <a class="ulink" href=
                "http://anduin.linuxfromscratch.org/files/BLFS/OpenJDK-1.7.0.40/jaxp.tar.gz">
                http://anduin.linuxfromscratch.org/files/BLFS/OpenJDK-1.7.0.40/jaxp.tar.gz</a><br />

                Download MD5 sum: 38834edb77ed2fd8e8828100deb6e943<br />
                Download Size: 3.7 MB<br />
              </p>
            </li>
            <li>
              <p>
                JAXWS Source<br />
                Download: <a class="ulink" href=
                "http://anduin.linuxfromscratch.org/files/BLFS/OpenJDK-1.7.0.40/jaxws.tar.gz">
                http://anduin.linuxfromscratch.org/files/BLFS/OpenJDK-1.7.0.40/jaxws.tar.gz</a><br />

                Download MD5 sum: 1426837479d61010728655315456a3d5<br />
                Download Size: 2.7 MB<br />
              </p>
            </li>
            <li>
              <p>
                Langtools Source<br />
                Download: <a class="ulink" href=
                "http://anduin.linuxfromscratch.org/files/BLFS/OpenJDK-1.7.0.40/langtools.tar.gz">
                http://anduin.linuxfromscratch.org/files/BLFS/OpenJDK-1.7.0.40/langtools.tar.gz</a><br />

                Download MD5 sum: 86f728535c6edb7b7ea2d567f2fcff87<br />
                Download Size: 2.3 MB<br />
              </p>
            </li>
            <li>
              <p>
                OpenJDK Source<br />
                Download: <a class="ulink" href=
                "http://anduin.linuxfromscratch.org/files/BLFS/OpenJDK-1.7.0.40/jdk.tar.gz">
                http://anduin.linuxfromscratch.org/files/BLFS/OpenJDK-1.7.0.40/jdk.tar.gz</a><br />

                Download MD5 sum: 9e71e7ad6ace7ce629e26088950ec32d<br />
                Download Size: 44 MB<br />
              </p>
            </li>
            <li>
              <p>
                Estimated disk space required: 8.1-9.2 GB
              </p>
            </li>
            <li>
              <p>
                Estimated build time: 47 SBU (an additional 156 SBU for
                testsuite)
              </p>
            </li>
          </ul>
        </div>
        <h3>
          Additional Downloads
        </h3>
        <h4>
          Required Patches
        </h4>
        <div class="itemizedlist">
          <ul class="compact">
            <li>
              <p>
                <a class="ulink" href=
                "http://www.linuxfromscratch.org/patches/blfs/svn/icedtea-2.4.1-add_cacerts-2.patch">
                http://www.linuxfromscratch.org/patches/blfs/svn/icedtea-2.4.1-add_cacerts-2.patch</a>
              </p>
            </li>
            <li>
              <p>
                <a class="ulink" href=
                "http://www.linuxfromscratch.org/patches/blfs/svn/icedtea-2.4.1-fixed_paths-1.patch">
                http://www.linuxfromscratch.org/patches/blfs/svn/icedtea-2.4.1-fixed_paths-1.patch</a>
              </p>
            </li>
            <li>
              <p>
                <a class="ulink" href=
                "http://www.linuxfromscratch.org/patches/blfs/svn/icedtea-2.4.1-fix_tests-1.patch">
                http://www.linuxfromscratch.org/patches/blfs/svn/icedtea-2.4.1-fix_tests-1.patch</a>
              </p>
            </li>
          </ul>
        </div>
        <h4>
          Required JAR
        </h4>
        <div class="itemizedlist">
          <ul class="compact">
            <li>
              <p>
                Rhino Java Script<br />
                Download: <a class="ulink" href=
                "ftp://ftp.mozilla.org/pub/mozilla.org/js/rhino1_7R3.zip">ftp://ftp.mozilla.org/pub/mozilla.org/js/rhino1_7R3.zip</a><br />

                Download MD5 sum: 99d94103662a8d0b571e247a77432ac5<br />
                Download Size: 4.5 MB<br />
              </p>
            </li>
          </ul>
        </div>
        <h3>
          OpenJDK Dependencies
        </h3>
        <h4>
          Required Dependencies
        </h4>
        <p class="required">
          An existing binary ( <a class="xref" href="java.html" title=
          "About Java">the section called &ldquo;About Java&rdquo;</a> or an
          earlier built version of this package, <a class="xref" href=
          "apache-ant.html" title="apache-ant-1.9.2">apache-ant-1.9.2</a>,
          <a class="xref" href="../postlfs/cacerts.html" title=
          "Certificate Authority Certificates">Certificate Authority
          Certificates</a>, <a class="xref" href="cpio.html" title=
          "cpio-2.11">cpio-2.11</a>, <a class="xref" href="../pst/cups.html"
          title="Cups-1.6.3">Cups-1.6.3</a>, <a class="xref" href=
          "../x/gtk3.html" title="GTK+-3.8.4">GTK+-3.8.4</a>, <a class="xref"
          href="giflib.html" title="giflib-5.0.5">giflib-5.0.5</a>, <a class=
          "xref" href="nspr.html" title="NSPR-4.10">NSPR-4.10</a>, <a class=
          "xref" href="../multimedia/pulseaudio.html" title=
          "PulseAudio-4.0">PulseAudio-4.0</a>, <a class="xref" href=
          "unzip.html" title="UnZip-6.0">UnZip-6.0</a>, <a class="xref" href=
          "../basicnet/wget.html" title="Wget-1.14">Wget-1.14</a>, <a class=
          "xref" href="which.html" title=
          "Which-2.20 and Alternatives">Which-2.20</a>, <a class="xref" href=
          "../x/x7lib.html" title="Xorg Libraries">Xorg Libraries</a>, and
          <a class="xref" href="zip.html" title="Zip-3.0">Zip-3.0</a>
        </p>
        <p class="usernotes">
          User Notes: <a class="ulink" href=
          "http://wiki.linuxfromscratch.org/blfs/wiki/openjdk">http://wiki.linuxfromscratch.org/blfs/wiki/openjdk</a>
        </p>
      </div>
      <div class="installation" lang="en" xml:lang="en">
        <h2 class="sect2">
          Installation of OpenJDK
        </h2>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            The source build of OpenJDK requires <a class="xref" href=
            "apache-ant.html" title="apache-ant-1.9.2">apache-ant-1.9.2</a>.
            You'll need to build that first to satisfy the circular
            dependency, and return to this section to continue building
            OpenJDK.
          </p>
        </div>
        <p>
          Unlike other packages in BLFS, the <span class=
          "application">OpenJDK</span> source packages are distributed in
          multiple downloads. Since the IcedTea build harness will be used to
          build <span class="application">OpenJDK</span>, begin by extracting
          the IcedTea package and changing into the extracted directory.
        </p>
        <p>
          The IcedTea <span class="application">OpenJDK</span> distribution
          requires that <code class="filename">js.jar</code> (from the Rhino
          package) be in place in order to provide a java-script
          implementation for the free JDK. If you have not installed the
          js.jar file in another way, do so with the following commands as
          the <code class="systemitem">root</code> user:
        </p>
        <pre class="root">
<kbd class="command">unzip ../rhino1_7R3.zip             &amp;&amp;
install -v -d -m755 /usr/share/java &amp;&amp;
install -v -m755 rhino1_7R3/*.jar /usr/share/java</kbd>
</pre>
        <p>
          As mentioned previously, <span class="application">OpenJDK</span>
          is composed of several individual projects of the proprietary
          <span class="application">JDK</span> that have been relicensed
          under an open source license. If you have already downoaded all of
          the individual components, place them into the source tree with the
          following commands:
        </p>
        <pre class="userinput">
<kbd class="command">cp -v ../corba.tar.gz     . &amp;&amp;
cp -v ../hotspot.tar.gz   . &amp;&amp;
cp -v ../jaxp.tar.gz      . &amp;&amp;
cp -v ../jaxws.tar.gz     . &amp;&amp;
cp -v ../jdk.tar.gz       . &amp;&amp;
cp -v ../langtools.tar.gz . &amp;&amp;
cp -v ../openjdk.tar.gz   .</kbd>
</pre>
        <p>
          Apply a patch to generate a valid cacerts file using the system CA
          certificates:
        </p>
        <pre class="userinput">
<kbd class="command">patch -Np1 -i ../icedtea-2.4.1-add_cacerts-2.patch</kbd>
</pre>
        <p>
          Apply a patch to replace fixed paths with ones appropriate for
          BLFS:
        </p>
        <pre class="userinput">
<kbd class="command">patch -Np1 -i ../icedtea-2.4.1-fixed_paths-1.patch</kbd>
</pre>
        <p>
          Apply a patch to exclude known broken tests from the test suite:
        </p>
        <pre class="userinput">
<kbd class="command">patch -Np1 -i ../icedtea-2.4.1-fix_tests-1.patch</kbd>
</pre>
        <p>
          Configure and build the package with the following commands
          (--with-pkgversion and --with-version-suffix values can be modified
          to fit user preferences):
        </p>
        <pre class="userinput">
<kbd class="command">unset JAVA_HOME &amp;&amp;
./autogen.sh    &amp;&amp;
./configure --with-jdk-home=/opt/OpenJDK-1.7.0.40-bin \
            --enable-nss                              \
            --with-version-suffix=blfs                \
            --enable-pulse-java &amp;&amp;
make</kbd>
</pre>
        <div class="admon note">
          <img alt="[Note]" src="../images/note.png" />
          <h3>
            Note
          </h3>
          <p>
            If you have not installed the tarballs specified above, they will
            be automatically downloaded here.
          </p>
        </div>
        <p>
          To test the results, issue: <span class="command"><strong>make
          jtregcheck</strong></span>. The included version of <span class=
          "application">jtreg</span> is old, and the test suite is also very
          dependent on the host system and the environment that it is run in.
          You should expect to see anywhere between 40 and 100 failures in
          jdk with up to 10 errors in the tests themselves. The majority of
          the 6000+ tests should pass. The reason for the greatly varying
          results is due to how stringent the testing environment must be.
          Varying architectures, different versions of dependent libraries,
          unexpected X Window environment and window managers, the CA
          certificates used to generate the <code class=
          "filename">cacerts</code> file, and even any user input or power
          management or screen saver interruptions during the testing can
          lead to various failures. While the known broken tests have been
          removed, with the fix_tests patch above, the graphics tests
          failures cannot be pre-determined (short of removing them all). The
          best bet for the minimal number of failures is to run the test
          suite in a framebuffer on a different screen (Xvfb). Even still,
          disk I/O can cause failures.
        </p>
        <pre class="userinput">
<kbd class="command">export DISPLAY=:20     &amp;&amp;
Xvfb :20 -screen 0 1x1x24 -ac&amp;
echo $!&gt;  Xvfb.pid     &amp;&amp;
make -k jtregcheck     &amp;&amp;
kill -9 `cat Xvfb.pid` &amp;&amp;
unset DISPLAY          &amp;&amp;
rm -f Xvfb.pid</kbd>
</pre>
        <p>
          Install the package with the following commands as the <code class=
          "systemitem">root</code> user:
        </p>
        <pre class="root">
<kbd class=
"command">chmod 0644 openjdk.build/j2sdk-image/lib/sa-jdi.jar  &amp;&amp;
cp -R openjdk.build/j2sdk-image /opt/OpenJDK-1.7.0.40 &amp;&amp;
chown -R root:root /opt/OpenJDK-1.7.0.40</kbd>
</pre>
      </div>
      <div class="commands" lang="en" xml:lang="en">
        <h2 class="sect2">
          Command Explanations
        </h2>
        <p>
          <span class="command"><strong>./autogen.sh</strong></span>: This
          command forces rebuilding of auto-generated files to account for
          new options added to <code class="filename">configure</code>.
        </p>
        <p>
          <em class="parameter"><code>--with-jdk-home</code></em>: This
          switch provides the location of the temporary <span class=
          "application">JDK</span>.
        </p>
        <p>
          <em class="parameter"><code>--with-pkgversion</code></em>: This
          switch can be used to modify the version string in addition to
          "IcedTea".
        </p>
        <p>
          <em class="parameter"><code>--with-version-suffix</code></em>: This
          switch appends the given text to the JDK version string.
        </p>
        <p>
          <em class="parameter"><code>--enable-pulse-java</code></em>: This
          switch enables building of the pulseaudio libraries (needed to
          provide a complete implementation that is reasonably compatible
          with the proprietary JDK).
        </p>
        <p>
          <span class="command"><strong>chmod -v 0644
          ...sa-jdi.jar</strong></span>: Fix permissions in a generated file
          so all users can access it.
        </p>
      </div>
      <div class="configuration" lang="en" xml:lang="en">
        <h2 class="sect2">
          <a id="openjdk-config" name="openjdk-config"></a>Configuring
          OpenJDK
        </h2>
        <div class="sect3" lang="en" xml:lang="en">
          <h3 class="sect3">
            Configuration Information
          </h3>
          <p>
            There are now two <span class="application">OpenJDK</span> SDKs
            installed in <code class="filename">/opt</code>. You should
            decide on which one you would like to use as the default. For
            example if you decide to use the precompiled <span class=
            "application">OpenJDK</span>, do the following as the
            <code class="systemitem">root</code> user:
          </p>
          <pre class="root">
<kbd class="command">ln -v -nsf OpenJDK-1.7.0.40-bin /opt/jdk</kbd>
</pre>
          <p>
            The information below assumes your system is set up using the
            instructions found in &ldquo;<span class="quote"><a class="xref"
            href="../postlfs/profile.html" title=
            "The Bash Shell Startup Files">The Bash Shell Startup
            Files</a></span>&rdquo;. You may need to extract the relevant
            information below and incorporate it into your system's startup
            files if your system is set up differently.
          </p>
          <p>
            Add the following <code class="filename">openjdk.sh</code> shell
            startup file to the <code class="filename">/etc/profile.d</code>
            directory with the following commands as the <code class=
            "systemitem">root</code> user:
          </p>
          <pre class="root">
<kbd class="command">cat &gt; /etc/profile.d/openjdk.sh &lt;&lt; "EOF"
<code class="literal"># Begin /etc/profile.d/openjdk.sh

# Set JAVA_HOME directory
JAVA_HOME=/opt/jdk

# Adjust PATH
pathappend $JAVA_HOME/bin PATH

# Auto Java CLASSPATH
# Copy jar files to, or create symlinks in this directory

AUTO_CLASSPATH_DIR=/usr/share/java

pathprepend . CLASSPATH

for dir in `find ${AUTO_CLASSPATH_DIR} -type d 2&gt;/dev/null`; do
    pathappend $dir CLASSPATH
done

for jar in `find ${AUTO_CLASSPATH_DIR} -name "*.jar" 2&gt;/dev/null`; do
    pathappend $jar CLASSPATH
done

export JAVA_HOME CLASSPATH
unset AUTO_CLASSPATH_DIR dir jar

# End /etc/profile.d/openjdk.sh</code>
EOF</kbd>
</pre>
          <p>
            Finally, add the man pages to <span class=
            "application">man_db</span>'s configuration. As the <code class=
            "systemitem">root</code> user:
          </p>
          <pre class="userinput">
<kbd class="command">cat &gt;&gt; /etc/man_db.conf &lt;&lt; "EOF" &amp;&amp;
<code class="literal">MANDATORY_MANPATH     /opt/jdk/man
MANPATH_MAP           /opt/jdk/bin     /opt/jdk/man
MANDB_MAP             /opt/jdk/man     /var/cache/man/jdk</code>
EOF

mandb -c /opt/jdk/man</kbd>
</pre>
        </div>
        <div class="sect3" lang="en" xml:lang="en">
          <h3 class="sect3">
            <a id="ojdk-certs" name="ojdk-certs"></a>Install or update the
            JRE Certificate Authority Certificates (cacerts) file
          </h3>
          <p>
            Use the following procedure to check if the <code class=
            "filename">cacerts</code> file was successfully installed during
            the OpenJDK build. Also, if the <a class="xref" href=
            "../postlfs/cacerts.html" title=
            "Certificate Authority Certificates">Certificate Authority
            Certificates</a> have been updated, the following instructions
            will generate a new JRE <code class="filename">cacerts</code>
            file. First, check if the <code class="filename">cacerts</code>
            have been successfully installed:
          </p>
          <pre class="root">
<kbd class="command">cd /opt/jdk
bin/keytool -list -keystore jre/lib/security/cacerts</kbd>
</pre>
          <p>
            At the prompt "Enter keystore password:", press the "Enter" key
            if there is no keystore password defined. If the <code class=
            "filename">cacerts</code> were installed correctly, you will see
            a list of the certificates with related information for each one.
            If not, you need to manually install them. First, generate the
            <span class="command"><strong>mkcacerts</strong></span> script as
            the <code class="systemitem">root</code> user:
          </p>
          <pre class="root">
<kbd class="command">cat &gt; /opt/jdk/bin/mkcacerts &lt;&lt; "EOF"
<code class="literal">#!/bin/sh
# Simple script to extract x509 certificates and create a JRE cacerts file.

function get_args()
    {
        if test -z "${1}" ; then
            showhelp
            exit 1
        fi

        while test -n "${1}" ; do
            case "${1}" in
                -f | --cafile)
                    check_arg $1 $2
                    CAFILE="${2}"
                    shift 2
                    ;;
                -d | --cadir)
                    check_arg $1 $2
                    CADIR="${2}"
                    shift 2
                    ;;
                -o | --outfile)
                    check_arg $1 $2
                    OUTFILE="${2}"
                    shift 2
                    ;;
                -k | --keytool)
                    check_arg $1 $2
                    KEYTOOL="${2}"
                    shift 2
                    ;;
                -s | --openssl)
                    check_arg $1 $2
                    OPENSSL="${2}"
                    shift 2
                    ;;
                -h | --help)
                    showhelp
                    exit 0
                    ;;
                *)
                    showhelp
                    exit 1
                    ;;
            esac
        done
    }

function check_arg()
    {
        echo "${2}" | grep -v "^-" &gt; /dev/null
        if [ -z "$?" -o ! -n "$2" ]; then
            echo "Error:  $1 requires a valid argument."
            exit 1
        fi
    }

# The date binary is not reliable on 32bit systems for dates after 2038
function mydate()
    {
        local y=$( echo $1 | cut -d" " -f4 )
        local M=$( echo $1 | cut -d" " -f1 )
        local d=$( echo $1 | cut -d" " -f2 )
        local m

        if [ ${d} -lt 10 ]; then d="0${d}"; fi

        case $M in
            Jan) m="01";;
            Feb) m="02";;
            Mar) m="03";;
            Apr) m="04";;
            May) m="05";;
            Jun) m="06";;
            Jul) m="07";;
            Aug) m="08";;
            Sep) m="09";;
            Oct) m="10";;
            Nov) m="11";;
            Dec) m="12";;
        esac

        certdate="${y}${m}${d}"
    }

function showhelp()
    {
        echo "`basename ${0}` creates a valid cacerts file for use with IcedTea."
        echo ""
        echo "        -f  --cafile        The path to a file containing PEM formated CA"
        echo "                            certificates.  May not be used with -d/--cadir."
        echo "        -d  --cadir         The path to a diectory of PEM formatted CA"
        echo "                            certificates.  May not be used with -f/--cafile."
        echo "        -o  --outfile       The path to the output file."
        echo ""
        echo "        -k  --keytool       The path to the java keytool utility."
        echo ""
        echo "        -s  --openssl       The path to the openssl utility."
        echo ""
        echo "        -h  --help          Show this help message and exit."
        echo ""
        echo ""
    }

# Initialize empty variables so that the shell does not polute the script
CAFILE=""
CADIR=""
OUTFILE=""
OPENSSL=""
KEYTOOL=""
certdate=""
date=""
today=$( date +%Y%m%d )

# Process command line arguments
get_args ${@}

# Handle common errors
if test "${CAFILE}x" == "x" -a "${CADIR}x" == "x" ; then
    echo "ERROR!  You must provide an x509 certificate store!"
    echo "\'$(basename ${0}) --help\' for more info."
    echo ""
    exit 1
fi

if test "${CAFILE}x" != "x" -a "${CADIR}x" != "x" ; then
    echo "ERROR!  You cannot provide two x509 certificate stores!"
    echo "\'$(basename ${0}) --help\' for more info."
    echo ""
    exit 1
fi

if test "${KEYTOOL}x" == "x" ; then
    echo "ERROR!  You must provide a valid keytool program!"
    echo "\'$(basename ${0}) --help\' for more info."
    echo ""
    exit 1
fi

if test "${OPENSSL}x" == "x" ; then
    echo "ERROR!  You must provide a valid path to openssl!"
    echo "\'$(basename ${0}) --help\' for more info."
    echo ""
    exit 1
fi

if test "${OUTFILE}x" == "x" ; then
    echo "ERROR!  You must provide a valid output file!"
    echo "\'$(basename ${0}) --help\' for more info."
    echo ""
    exit 1
fi

# Get on with the work

# If using a CAFILE, split it into individual files in a temp directory
if test "${CAFILE}x" != "x" ; then
    TEMPDIR=`mktemp -d`
    CADIR="${TEMPDIR}"

    # Get a list of staring lines for each cert
    CERTLIST=`grep -n "^-----BEGIN" "${CAFILE}" | cut -d ":" -f 1`

    # Get a list of ending lines for each cert
    ENDCERTLIST=`grep -n "^-----END" "${CAFILE}" | cut -d ":" -f 1`

    # Start a loop
    for certbegin in `echo "${CERTLIST}"` ; do
        for certend in `echo "${ENDCERTLIST}"` ; do
            if test "${certend}" -gt "${certbegin}"; then
                break
            fi
        done
        sed -n "${certbegin},${certend}p" "${CAFILE}" &gt; "${CADIR}/${certbegin}.pem"
        keyhash=`${OPENSSL} x509 -noout -in "${CADIR}/${certbegin}.pem" -hash`
        echo "Generated PEM file with hash:  ${keyhash}."
    done
fi

# Write the output file
for cert in `find "${CADIR}" -type f -name "*.pem" -o -name "*.crt"`
do

    # Make sure the certificate date is valid...
    date=$( ${OPENSSL} x509 -enddate -in "${cert}" -noout | sed 's/^notAfter=//' )
    mydate "${date}"
    if test "${certdate}" -lt "${today}" ; then
        echo "${cert} expired on ${certdate}! Skipping..."
        unset date certdate
        continue
    fi
    unset date certdate
    ls "${cert}"
    tempfile=`mktemp`
    certbegin=`grep -n "^-----BEGIN" "${cert}" | cut -d ":" -f 1`
    certend=`grep -n "^-----END" "${cert}" | cut -d ":" -f 1`
    sed -n "${certbegin},${certend}p" "${cert}" &gt; "${tempfile}"
    echo yes | env LC_ALL=C "${KEYTOOL}" -import -alias `basename "${cert}"` -keystore \
                   "${OUTFILE}" -storepass 'changeit' -file "${tempfile}"
    rm "${tempfile}"
done

if test "${TEMPDIR}x" != "x" ; then
    rm -rf "${TEMPDIR}"
fi
exit 0</code>
EOF

chmod -c 0755 /opt/jdk/bin/mkcacerts</kbd>
</pre>
          <div class="admon note">
            <img alt="[Note]" src="../images/note.png" />
            <h3>
              Note
            </h3>
            <p>
              Doing a very large copy/paste directly to a terminal may result
              in a corrupted file. Copying to an editor may overcome this
              issue.
            </p>
          </div>
          <p>
            First, make a backup of the <code class=
            "filename">/opt/jdk/jre/lib/security/cacerts</code> file, if
            there is any. To create a new one, as the <code class=
            "systemitem">root</code> user:
          </p>
          <pre class="userinput">
<kbd class=
"command">/opt/jdk/bin/mkcacerts -d "/etc/ssl/certs/"  -k "/opt/jdk/bin/keytool" \
                       -s "/usr/bin/openssl" -o "/opt/jdk/jre/lib/security/cacerts"</kbd>
</pre>
        </div>
      </div>
      <div class="content" lang="en" xml:lang="en">
        <h2 class="sect2">
          Contents
        </h2>
        <div class="segmentedlist">
          <div class="seglistitem">
            <div class="seg">
              <strong class="segtitle">Installed Programs:</strong>
              <span class="segbody">appletviewer, apt, extcheck, idlj, jar,
              jarsigner, java, javac, javadoc, javah, javap, java-rmi.cgi,
              jcmd, jconsole, jdb, jhat, jinfo, jmap, jps, jrunscript,
              jsadebugd, jstack, jstat, jstatd, keytool, native2ascii, orbd,
              pack200, policytool, rmic, rmid, rmiregistry, schemagen,
              serialver, servertool, tnameserv, unpack200, wsgen, wsimport,
              and xjc</span>
            </div>
            <div class="seg">
              <strong class="segtitle">Installed Libraries:</strong>
              <span class="segbody">/opt/OpenJDK-1.7.0.40/lib/*, and
              /opt/OpenJDK-1.7.0.40/jre/lib/*</span>
            </div>
            <div class="seg">
              <strong class="segtitle">Installed Directory:</strong>
              <span class="segbody">/opt/OpenJDK-1.7.0.40</span>
            </div>
          </div>
        </div>
        <div class="variablelist">
          <h3>
            Short Descriptions
          </h3>
          <table border="0">
            <col align="left" valign="top" />
            <tbody>
              <tr>
                <td>
                  <p>
                    <a id="appletviewer" name="appletviewer"></a><span class=
                    "term"><span class=
                    "command"><strong>appletviewer</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    allows you to run applets outside of a web browser.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="apt" name="apt"></a><span class=
                    "term"><span class="command"><strong>apt</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is an annotation processing tool.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="extcheck" name="extcheck"></a><span class=
                    "term"><span class=
                    "command"><strong>extcheck</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    checks a specified jar file for title and version
                    conflicts with any extensions installed in the
                    <span class="application">OpenJDK</span> software.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="idlj" name="idlj"></a><span class=
                    "term"><span class=
                    "command"><strong>idlj</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    generates Java bindings from a given IDL file.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="jar" name="jar"></a><span class=
                    "term"><span class="command"><strong>jar</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    combines multiple files into a single jar archive.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="jarsigner" name="jarsigner"></a><span class=
                    "term"><span class=
                    "command"><strong>jarsigner</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    signs jar files and verifies the signatures and integrity
                    of a signed jar file.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="java-prog" name="java-prog"></a><span class=
                    "term"><span class=
                    "command"><strong>java</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    launches a Java application by starting a Java runtime
                    environment, loading a specified class and invoking its
                    main method.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="javac" name="javac"></a><span class=
                    "term"><span class=
                    "command"><strong>javac</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    reads class and interface definitions, written in the
                    Java programming language, and compiles them into
                    bytecode class files.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="javadoc" name="javadoc"></a><span class=
                    "term"><span class=
                    "command"><strong>javadoc</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    parses the declarations and documentation comments in a
                    set of Java source files and produces a corresponding set
                    of HTML pages describing the classes,
                    interfaces,constructors, methods, and fields.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="javah" name="javah"></a><span class=
                    "term"><span class=
                    "command"><strong>javah</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    generates C header and source files that are needed to
                    implement native methods.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="javap" name="javap"></a><span class=
                    "term"><span class=
                    "command"><strong>javap</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    disassembles a Java class file.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="java-rmi.cgi" name="java-rmi.cgi"></a><span class=
                    "term"><span class=
                    "command"><strong>java-rmi.cgi</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is the Java RMI client.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="jcmd" name="jcmd"></a><span class=
                    "term"><span class=
                    "command"><strong>jcmd</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is a utility to send diagnostic command requests to a
                    running Java Virtual Machine.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="jconsole" name="jconsole"></a><span class=
                    "term"><span class=
                    "command"><strong>jconsole</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is a graphical console tool to monitor and manage both
                    local and remote Java applications and virtual machines.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="jdb" name="jdb"></a><span class=
                    "term"><span class="command"><strong>jdb</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is a simple command-line debugger for Java classes.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="jhat" name="jhat"></a><span class=
                    "term"><span class=
                    "command"><strong>jhat</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    parses a java heap dump file and allows viewing in a web
                    browser.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="jinfo" name="jinfo"></a><span class=
                    "term"><span class=
                    "command"><strong>jinfo</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    prints Java configuration information for a given Java
                    process, core file, or a remote debug server.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="jmap" name="jmap"></a><span class=
                    "term"><span class=
                    "command"><strong>jmap</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    prints shared object memory maps or heap memory details
                    of a given process, core file, or a remote debug server.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="jps" name="jps"></a><span class=
                    "term"><span class="command"><strong>jps</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    lists the instrumented JVMs on the target system.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="jrunscript" name="jrunscript"></a><span class=
                    "term"><span class=
                    "command"><strong>jrunscript</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is a command line script shell.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="jsadebugd" name="jsadebugd"></a><span class=
                    "term"><span class=
                    "command"><strong>jsadebugd</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    attaches to a Java process or core file and acts as a
                    debug server.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="jstack" name="jstack"></a><span class=
                    "term"><span class=
                    "command"><strong>jstack</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    prints Java stack traces of Java threads for a given Java
                    process, core file, or a remote debug server.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="jstat" name="jstat"></a><span class=
                    "term"><span class=
                    "command"><strong>jstat</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    displays performance statistics for an instrumented JVM.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="jstatd" name="jstatd"></a><span class=
                    "term"><span class=
                    "command"><strong>jstatd</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is an RMI server application that monitors for the
                    creation and termination of instrumented JVMs.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="keytool" name="keytool"></a><span class=
                    "term"><span class=
                    "command"><strong>keytool</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is a key and certificate management utility.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="native2ascii" name="native2ascii"></a><span class=
                    "term"><span class=
                    "command"><strong>native2ascii</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    converts files that contain non-supported character
                    encoding into files containing Latin-1 or Unicode-encoded
                    characters.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="orbd" name="orbd"></a><span class=
                    "term"><span class=
                    "command"><strong>orbd</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is used to enable clients to transparently locate and
                    invoke persistent objects on servers in the CORBA
                    environment.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="pack200" name="pack200"></a><span class=
                    "term"><span class=
                    "command"><strong>pack200</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is a Java application that transforms a jar file into a
                    compressed pack200 file using the Java gzip compressor.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="policytool" name="policytool"></a><span class=
                    "term"><span class=
                    "command"><strong>policytool</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    creates and manages a policy file graphically.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="rmic" name="rmic"></a><span class=
                    "term"><span class=
                    "command"><strong>rmic</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    generates stub and skeleton class files for remote
                    objects from the names of compiled Java classes that
                    contain remote object implementations.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="rmid" name="rmid"></a><span class=
                    "term"><span class=
                    "command"><strong>rmid</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    starts the activation system daemon.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="rmiregistry" name="rmiregistry"></a><span class=
                    "term"><span class=
                    "command"><strong>rmiregistry</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    creates and starts a remote object registry on the
                    specified port on the current host.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="schemagen" name="schemagen"></a><span class=
                    "term"><span class=
                    "command"><strong>schemagen</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is a Java XML binding schema generator.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="serialver" name="serialver"></a><span class=
                    "term"><span class=
                    "command"><strong>serialver</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    returns the serialVersionUID for one or more classes in a
                    form suitable for copying into an evolving class.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="servertool" name="servertool"></a><span class=
                    "term"><span class=
                    "command"><strong>servertool</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    provides an ease-of-use interface for application
                    programmers to register, unregister, startup and shutdown
                    a server.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="tnameserv" name="tnameserv"></a><span class=
                    "term"><span class=
                    "command"><strong>tnameserv</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    starts the Java IDL name server.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="unpack200" name="unpack200"></a><span class=
                    "term"><span class=
                    "command"><strong>unpack200</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is a native implementation that transforms a packed file
                    produced by <span class="application">pack200</span> into
                    a jar file.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="wsgen" name="wsgen"></a><span class=
                    "term"><span class=
                    "command"><strong>wsgen</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    generates JAX-WS portable artifacts used in JAX-WS web
                    services.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="wsimport" name="wsimport"></a><span class=
                    "term"><span class=
                    "command"><strong>wsimport</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    generates JAX-WS portable artifacts.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p>
                    <a id="xjc" name="xjc"></a><span class=
                    "term"><span class="command"><strong>xjc</strong></span></span>
                  </p>
                </td>
                <td>
                  <p>
                    is a Java XML binding compiler.
                  </p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <p class="updated">
        Last updated on 2013-09-12 10:33:55 +0000
      </p>
    </div>
    <div class="navfooter">
      <ul>
        <li class="prev">
          <a accesskey="p" href="apache-ant.html" title=
          "apache-ant-1.9.2">Prev</a>
          <p>
            apache-ant-1.9.2
          </p>
        </li>
        <li class="next">
          <a accesskey="n" href="../basicnet/basicnet.html" title=
          "Networking">Next</a>
          <p>
            Networking
          </p>
        </li>
        <li class="up">
          <a accesskey="u" href="prog.html" title=
          "Chapter&nbsp;13.&nbsp;Programming">Up</a>
        </li>
        <li class="home">
          <a accesskey="h" href="../index.html" title=
          "Beyond Linux® From Scratch - Version 2013-09-12">Home</a>
        </li>
      </ul>
    </div>
  </body>
</html>
